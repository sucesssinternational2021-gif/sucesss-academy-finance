<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sucesss Model International Academy</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #1a5f7a;
            --secondary: #27ae60;
            --accent: #f39c12;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --info: #3498db;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
        }
        
        body {
            background: #f5f7fa;
            color: var(--dark);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            background: white;
            color: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 22px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .school-info h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .school-info p {
            font-size: 14px;
            opacity: 0.9;
            color: #bdc3c7;
        }
        
        .user-nav {
            display: flex;
            align-items: center;
            gap: 25px;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-profile:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 18px;
        }
        
        .user-details h4 {
            font-size: 15px;
            margin-bottom: 3px;
        }
        
        .user-details span {
            font-size: 12px;
            color: #bdc3c7;
        }
        
        .nav-controls {
            display: flex;
            gap: 12px;
        }
        
        .nav-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            text-decoration: none;
        }
        
        .nav-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .nav-btn.logout {
            background: rgba(231, 76, 60, 0.2);
            color: #ff9b93;
        }
        
        .nav-btn.logout:hover {
            background: rgba(231, 76, 60, 0.3);
        }
        
        /* Main Content */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        /* Dashboard Header */
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .dashboard-title h2 {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .dashboard-title p {
            color: var(--gray);
            font-size: 16px;
        }
        
        .date-selector {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .date-box {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
            border: 2px solid var(--light);
        }
        
        .date-box h4 {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .date-box p {
            color: var(--dark);
            font-size: 20px;
            font-weight: 600;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
            border-top: 5px solid;
        }
        
        .stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }
        
        .stat-card.kg {
            border-color: #9b59b6;
        }
        
        .stat-card.nursery {
            border-color: #3498db;
        }
        
        .stat-card.primary {
            border-color: #2ecc71;
        }
        
        .stat-card.secondary {
            border-color: #f39c12;
        }
        
        .stat-card.revenue {
            border-color: #27ae60;
        }
        
        .stat-card.levies {
            border-color: #1a5f7a;
        }
        
        .stat-card.outstanding {
            border-color: #e74c3c;
        }
        
        .stat-card.carried {
            border-color: #f1c40f;
        }
        
        .stat-card.expenses {
            border-color: #95a5a6;
        }
        
        .stat-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--light);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            opacity: 0.2;
        }
        
        .stat-content h3 {
            color: var(--gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .stat-value::before {
            content: "₦ ";
        }
        
        .stat-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--light);
        }
        
        .stat-change {
            font-size: 14px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
        }
        
        .stat-change.positive {
            background: #d4edda;
            color: #27ae60;
        }
        
        .stat-change.negative {
            background: #f8d7da;
            color: #e74c3c;
        }
        
        .stat-period {
            color: var(--gray);
            font-size: 13px;
        }
        
        /* Charts Section */
        .charts-section {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1100px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .chart-header h3 {
            color: var(--dark);
            font-size: 20px;
            font-weight: 600;
        }
        
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* Recent Activity */
        .activity-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }
        
        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .activity-header h3 {
            color: var(--dark);
            font-size: 20px;
            font-weight: 600;
        }
        
        .activity-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .activity-table th {
            text-align: left;
            padding: 15px;
            background: var(--light);
            color: var(--gray);
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .activity-table td {
            padding: 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .activity-table tr:hover {
            background: #f8fafc;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-paid {
            background: #d4edda;
            color: #27ae60;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #f39c12;
        }
        
        .status-overdue {
            background: #f8d7da;
            color: #e74c3c;
        }
        
        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 50px;
        }
        
        .action-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
            text-decoration: none;
            color: var(--dark);
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.12);
            border-color: var(--primary);
        }
        
        .action-icon {
            width: 70px;
            height: 70px;
            background: var(--light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 30px;
            color: var(--primary);
        }
        
        .action-card h4 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .action-card p {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Footer */
        .footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            margin-top: 50px;
        }
        
        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
        }
        
        .footer-section h4 {
            color: var(--secondary);
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .footer-section p,
        .footer-section a {
            color: #bdc3c7;
            margin-bottom: 10px;
            display: block;
            text-decoration: none;
            font-size: 14px;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 30px;
            margin-top: 30px;
            border-top: 1px solid #34495e;
            color: #95a5a6;
            font-size: 14px;
        }
        
        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 300px;
            font-size: 18px;
            color: var(--gray);
        }
        
        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .dashboard-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .date-selector {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .user-nav {
                flex-direction: column;
                gap: 15px;
            }
            
            .nav-controls {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <div class="logo-icon">SMIA</div>
                <div class="school-info">
                    <h1>Sucesss Model International Academy</h1>
                    <p>Financial Dashboard System</p>
                </div>
            </div>
            
            <div class="user-nav">
                <div class="date-selector">
                    <div class="date-box">
                        <h4>Academic Year</h4>
                        <p>2023/2024</p>
                    </div>
                    <div class="date-box">
                        <h4>Current Term</h4>
                        <p>3rd Term</p>
                    </div>
                </div>
                
                <div class="nav-controls">
                    <a href="payment.html" class="nav-btn">
                        <i class="fas fa-plus-circle"></i> New Payment
                    </a>
                    <a href="students.html" class="nav-btn">
                        <i class="fas fa-user-graduate"></i> Students
                    </a>
                    <button class="nav-btn logout" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                
                <div class="user-profile" onclick="window.location.href='profile.html'">
                    <div class="user-avatar" id="userAvatar">FA</div>
                    <div class="user-details">
                        <h4 id="userName">Finance Admin</h4>
                        <span id="userRole">Administrator</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Dashboard Header -->
        <div class="dashboard-header">
            <div class="dashboard-title">
                <h2>Financial Overview Dashboard</h2>
                <p>Complete financial summary for Sucesss Model International Academy</p>
            </div>
            <div class="date-box">
                <h4>Last Updated</h4>
                <p id="currentDate">Loading...</p>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <!-- Student Categories -->
            <div class="stat-card kg">
                <div class="stat-icon">
                    <i class="fas fa-baby"></i>
                </div>
                <div class="stat-content">
                    <h3>KG Students</h3>
                    <div class="stat-value" id="kgStudents">0</div>
                    <div class="stat-details">
                        <div class="stat-period">Total Enrolled</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card nursery">
                <div class="stat-icon">
                    <i class="fas fa-child"></i>
                </div>
                <div class="stat-content">
                    <h3>Nursery Students</h3>
                    <div class="stat-value" id="nurseryStudents">0</div>
                    <div class="stat-details">
                        <div class="stat-period">Total Enrolled</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card primary">
                <div class="stat-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="stat-content">
                    <h3>Primary Students</h3>
                    <div class="stat-value" id="primaryStudents">0</div>
                    <div class="stat-details">
                        <div class="stat-period">Total Enrolled</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card secondary">
                <div class="stat-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="stat-content">
                    <h3>Secondary Students</h3>
                    <div class="stat-value" id="secondaryStudents">0</div>
                    <div class="stat-details">
                        <div class="stat-period">Total Enrolled</div>
                    </div>
                </div>
            </div>
            
            <!-- Financial Metrics -->
            <div class="stat-card revenue">
                <div class="stat-icon">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Fees Paid</h3>
                    <div class="stat-value" id="totalFeesPaid">0</div>
                    <div class="stat-details">
                        <div class="stat-change positive" id="feesChange">+0%</div>
                        <div class="stat-period">This Term</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card levies">
                <div class="stat-icon">
                    <i class="fas fa-hand-holding-usd"></i>
                </div>
                <div class="stat-content">
                    <h3>Total PTA/Levies Paid</h3>
                    <div class="stat-value" id="totalLeviesPaid">0</div>
                    <div class="stat-details">
                        <div class="stat-change positive" id="leviesChange">+0%</div>
                        <div class="stat-period">Per Learner Average</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card outstanding">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Outstanding Fees</h3>
                    <div class="stat-value" id="totalOutstanding">0</div>
                    <div class="stat-details">
                        <div class="stat-change negative" id="outstandingChange">+0%</div>
                        <div class="stat-period">Requires Attention</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card carried">
                <div class="stat-icon">
                    <i class="fas fa-forward"></i>
                </div>
                <div class="stat-content">
                    <h3>Fees Carried Forward</h3>
                    <div class="stat-value" id="feesCarriedForward">0</div>
                    <div class="stat-details">
                        <div class="stat-change negative" id="carriedChange">+0%</div>
                        <div class="stat-period">To Next Term</div>
                    </div>
                </div>
            </div>
            
            <div class="stat-card expenses">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Expenses</h3>
                    <div class="stat-value" id="totalExpenses">0</div>
                    <div class="stat-details">
                        <div class="stat-change negative" id="expensesChange">+0%</div>
                        <div class="stat-period">Operational Costs</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Revenue vs Expenses</h3>
                    <select id="chartPeriod" onchange="updateCharts()">
                        <option value="month">This Month</option>
                        <option value="term" selected>This Term</option>
                        <option value="year">This Year</option>
                    </select>
                </div>
                <div class="chart-container">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <div class="chart-header">
                    <h3>Student Distribution</h3>
                </div>
                <div class="chart-container">
                    <canvas id="studentsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="activity-section">
            <div class="activity-header">
                <h3>Recent Financial Activities</h3>
                <a href="reports.html" class="nav-btn">
                    <i class="fas fa-file-alt"></i> View All Reports
                </a>
            </div>
            
            <table class="activity-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Student</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="activityTable">
                    <!-- Activities will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="payment.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-credit-card"></i>
                </div>
                <h4>Record Payment</h4>
                <p>Process student fee payments</p>
            </a>
            
            <a href="students.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-user-plus"></i>
                </div>
                <h4>Add Student</h4>
                <p>Register new students</p>
            </a>
            
            <a href="fees.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <h4>Fee Structure</h4>
                <p>Manage fee schedules</p>
            </a>
            
            <a href="reports.html" class="action-card">
                <div class="action-icon">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <h4>Generate Reports</h4>
                <p>Financial analysis reports</p>
            </a>
            
            <a href="#" class="action-card" onclick="exportData()">
                <div class="action-icon">
                    <i class="fas fa-download"></i>
                </div>
                <h4>Export Data</h4>
                <p>Download financial data</p>
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-section">
                <h4>Sucesss Model International Academy</h4>
                <p>Excellence in Education Since 2021</p>
                <p>NO13 Behind COCIN Church Gura-Landoh Gyel</p>
                <p>Plateau State, Nigeria</p>
            </div>
            
            <div class="footer-section">
                <h4>Contact Information</h4>
                <p><i class="fas fa-phone"></i> 09020488851</p>
                <p><i class="fas fa-envelope"></i> sucesssinternational2021@gmail.com</p>
                <p><i class="fas fa-clock"></i> Mon-Fri: 8:00 AM - 4:00 PM</p>
            </div>
            
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="dashboard.html">Dashboard</a>
                <a href="payment.html">Payment Portal</a>
                <a href="students.html">Student Management</a>
                <a href="reports.html">Financial Reports</a>
            </div>
            
            <div class="footer-section">
                <h4>System Information</h4>
                <p>Financial Management System v3.0</p>
                <p>Powered by Firebase</p>
                <p>Last Updated: <span id="lastUpdated">Loading...</span></p>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2024 Sucesss Model International Academy. All Rights Reserved.</p>
            <p>All amounts in Nigerian Naira (₦)</p>
        </div>
    </footer>

    <!-- Firebase Configuration -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-init.js"></script>
    <script type="module" src="firebase-service.js"></script>
    
    <script type="module">
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        
        document.addEventListener('DOMContentLoaded', async function() {
            // Check authentication
            const user = JSON.parse(localStorage.getItem('sucesss_user') || '{}');
            if (!user.email || !user.uid) {
                window.location.href = 'index.html';
                return;
            }
            
            // Set user info
            document.getElementById('userName').textContent = user.name || 'Finance Admin';
            document.getElementById('userRole').textContent = user.role || 'Administrator';
            document.getElementById('userAvatar').textContent = user.name?.charAt(0) || 'FA';
            
            // Set current date
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-NG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('lastUpdated').textContent = now.toLocaleTimeString('en-NG');
            
            // Show loading
            showLoading();
            
            // Load dashboard data
            await loadDashboardData();
            
            // Initialize charts
            initializeCharts();
            
            // Load recent activities
            await loadRecentActivities();
            
            // Set up auto-refresh (every 5 minutes)
            setInterval(async () => {
                await loadDashboardData();
                await loadRecentActivities();
                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString('en-NG');
            }, 300000);
        });
        
        async function loadDashboardData() {
            try {
                // In a real implementation, you would fetch from Firebase
                // For now, we'll use mock data that simulates Firebase data
                
                // Mock data - Replace with actual Firebase queries
                const mockData = {
                    kgStudents: 45,
                    nurseryStudents: 78,
                    primaryStudents: 156,
                    secondaryStudents: 92,
                    totalFeesPaid: 18500000,
                    totalLeviesPaid: 3450000,
                    totalOutstanding: 4250000,
                    feesCarriedForward: 2100000,
                    totalExpenses: 9750000
                };
                
                // Update UI with data
                document.getElementById('kgStudents').textContent = mockData.kgStudents.toLocaleString();
                document.getElementById('nurseryStudents').textContent = mockData.nurseryStudents.toLocaleString();
                document.getElementById('primaryStudents').textContent = mockData.primaryStudents.toLocaleString();
                document.getElementById('secondaryStudents').textContent = mockData.secondaryStudents.toLocaleString();
                document.getElementById('totalFeesPaid').textContent = mockData.totalFeesPaid.toLocaleString();
                document.getElementById('totalLeviesPaid').textContent = mockData.totalLeviesPaid.toLocaleString();
                document.getElementById('totalOutstanding').textContent = mockData.totalOutstanding.toLocaleString();
                document.getElementById('feesCarriedForward').textContent = mockData.feesCarriedForward.toLocaleString();
                document.getElementById('totalExpenses').textContent = mockData.totalExpenses.toLocaleString();
                
                // Calculate changes (mock data)
                document.getElementById('feesChange').textContent = '+12%';
                document.getElementById('leviesChange').textContent = '+8%';
                document.getElementById('outstandingChange').textContent = '+5%';
                document.getElementById('carriedChange').textContent = '+3%';
                document.getElementById('expensesChange').textContent = '+15%';
                
                // Hide loading
                hideLoading();
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showError('Failed to load dashboard data');
            }
        }
        
        async function loadRecentActivities() {
            try {
                // Mock recent activities - Replace with Firebase data
                const activities = [
                    { date: '2024-03-15', student: 'John Musa', type: 'Tuition', description: '3rd Term Fees', amount: 85000, status: 'paid' },
                    { date: '2024-03-14', student: 'Sarah James', type: 'PTA Levies', description: 'Development Levy', amount: 5000, status: 'paid' },
                    { date: '2024-03-13', student: 'Michael Okoro', type: 'Tuition', description: 'Balance Payment', amount: 25000, status: 'pending' },
                    { date: '2024-03-12', student: 'Grace Bala', type: 'Examination', description: 'WAEC Registration', amount: 45000, status: 'paid' },
                    { date: '2024-03-11', student: 'David Samuel', type: 'Other', description: 'Excursion Fee', amount: 15000, status: 'overdue' }
                ];
                
                const tableBody = document.getElementById('activityTable');
                tableBody.innerHTML = '';
                
                activities.forEach(activity => {
                    const row = document.createElement('tr');
                    
                    // Format date
                    const date = new Date(activity.date);
                    const formattedDate = date.toLocaleDateString('en-NG');
                    
                    // Determine status class
                    let statusClass = 'status-paid';
                    if (activity.status === 'pending') statusClass = 'status-pending';
                    if (activity.status === 'overdue') statusClass = 'status-overdue';
                    
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td><strong>${activity.student}</strong></td>
                        <td>${activity.type}</td>
                        <td>${activity.description}</td>
                        <td><strong>₦${activity.amount.toLocaleString()}</strong></td>
                        <td><span class="status-badge ${statusClass}">${activity.status.toUpperCase()}</span></td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading recent activities:', error);
            }
        }
        
        function initializeCharts() {
            // Revenue vs Expenses Chart
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            const revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: ['KG', 'Nursery', 'Primary', 'Secondary'],
                    datasets: [
                        {
                            label: 'Revenue (₦)',
                            data: [1850000, 3250000, 7850000, 5550000],
                            backgroundColor: '#27ae60',
                            borderColor: '#219653',
                            borderWidth: 1
                        },
                        {
                            label: 'Expenses (₦)',
                            data: [950000, 1650000, 3850000, 3300000],
                            backgroundColor: '#95a5a6',
                            borderColor: '#7f8c8d',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '₦' + (value / 1000000).toFixed(1) + 'M';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += '₦' + context.raw.toLocaleString();
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
            
            // Students Distribution Chart
            const studentsCtx = document.getElementById('studentsChart').getContext('2d');
            const studentsChart = new Chart(studentsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['KG (12%)', 'Nursery (21%)', 'Primary (42%)', 'Secondary (25%)'],
                    datasets: [{
                        data: [45, 78, 156, 92],
                        backgroundColor: [
                            '#9b59b6',
                            '#3498db',
                            '#2ecc71',
                            '#f39c12'
                        ],
                        borderColor: [
                            '#8e44ad',
                            '#2980b9',
                            '#27ae60',
                            '#e67e22'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((context.raw / total) * 100);
                                    return `${context.label}: ${context.raw} students (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Store charts for updates
            window.revenueChart = revenueChart;
            window.studentsChart = studentsChart;
        }
        
        function updateCharts() {
            const period = document.getElementById('chartPeriod').value;
            
            // Update charts based on selected period
            // In a real implementation, you would fetch new data from Firebase
            console.log('Updating charts for period:', period);
            
            // For now, just show a message
            alert('Chart data would update based on ' + period + ' selection. In production, this would fetch real data from Firebase.');
        }
        
        async function logout() {
            try {
                const auth = getAuth();
                await signOut(auth);
                localStorage.removeItem('sucesss_user');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        }
        
        function exportData() {
            // Create a simple data export
            const data = {
                school: "Sucesss Model International Academy",
                exportDate: new Date().toISOString(),
                financialSummary: {
                    totalStudents: 371,
                    totalRevenue: 18500000,
                    totalExpenses: 9750000,
                    netBalance: 8750000
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `sucesss-financial-export-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('Data export started. Check your downloads folder.');
        }
        
        function showLoading() {
            const statsGrid = document.querySelector('.stats-grid');
            statsGrid.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Loading dashboard data from Firebase...
                </div>
            `;
        }
        
        function hideLoading() {
            // Loading is hidden when data loads
        }
        
        function showError(message) {
            const statsGrid = document.querySelector('.stats-grid');
            statsGrid.innerHTML = `
                <div class="loading" style="color: #e74c3c;">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 15px; font-size: 24px;"></i>
                    ${message}
                </div>
            `;
        }
    </script>
</body>
</html>
